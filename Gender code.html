<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edukasi AR: Gender</title>
    <!-- Memuat Tailwind CSS untuk styling dasar UI/Instruksi -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat A-Frame dan AR.js (A-Frame untuk 3D, AR.js untuk pengenalan Marker) -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        /* Mengatur agar elemen UI berada di atas kamera AR */
        #ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10;
        }
        /* Menyembunyikan elemen A-Frame/AR.js saat tidak diperlukan */
        .a-loader-title { color: #10B981 !important; }
        .a-enter-vr-button { display: none !important; }
    </style>
</head>

<body class="bg-gray-100 font-sans">

    <!-- Kontainer UI/Instruksi yang Muncul di Atas Kamera AR -->
    <div id="ui-overlay" class="w-full p-4 md:p-8 bg-white/70 backdrop-blur-sm rounded-b-lg shadow-xl">
        <h1 class="text-2xl font-bold text-emerald-600 mb-2">Edukasi AR: Kekerasan Berbasis Gender</h1>
        <p class="text-sm text-gray-700">Arahkan kamera ponsel Anda ke **Marker Gender** (`Gender.patt`).</p>
        <p class="text-xs text-red-600 font-semibold mt-2">
            ⚠️ **Pastikan:** File `Gender.mp4` dan `Gender.patt` sudah diunggah ke *root* folder di GitHub Pages Anda.
        </p>
    </div>

    <!-- 1. A-ASSETS: Tempat untuk memuat aset (video, gambar) sebelum digunakan -->
    <a-assets>
        <!-- 
            MENGGANTI SRC DENGAN VIDEO MP4 BARU: Gender.mp4
        -->
        <video id="videoAnimasi" preload="auto" loop="true" src="Gender.mp4" playsinline webkit-playsinline crossorigin="anonymous"></video>
    </a-assets>

    <!-- 2. A-SCENE: Mendefinisikan lingkungan Augmented Reality -->
    <a-scene 
        id="scene"
        vr-mode-ui="enabled: false" 
        loading-screen="enabled: false"
        arjs='sourceType: webcam; detectionMode: mono; cameraParametersUrl: https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/camera-parameters.zip;'
    >
        
        <!-- 3. A-MARKER: Mendefinisikan Target Gambar (Image Target) -->
        <!-- 
            MENGGANTI URL DENGAN FILE .PATT BARU: Gender.patt
        -->
        <a-marker type='pattern' url='Gender.patt'>
            
            <!-- 4. A-VIDEO: Konten yang akan muncul setelah marker dikenali -->
            <a-video 
                src="#videoAnimasi" 
                width="1.5" 
                height="0.84" 
                position="0 0 0" 
                rotation="-90 0 0"
                play-on-marker-found
                
                <!-- Menggunakan Chroma Key Shader untuk menghilangkan warna hijau -->
                material="shader: chromakey; keyColor: #00ff00; transparent: true; opacity: 1.0"
            ></a-video>

        </a-marker>

        <!-- 5. CAMERA: Kamera yang digunakan untuk melihat dunia nyata -->
        <a-entity camera></a-entity>

    </a-scene>

    <!-- JavaScript untuk mendefinisikan Chroma Key Shader dan menangani pemutaran video -->
    <script>
        // 1. CHROMA KEY SHADER: Mengganti warna tertentu (hijau) dengan transparansi
        AFRAME.registerShader('chromakey', {
            schema: {
                src: {type: 'map'},
                keyColor: {default: '#00ff00', type: 'color', is: 'uniform'} // Warna hijau yang akan dihilangkan
            },
            vertexShader: `
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,
            fragmentShader: `
                uniform sampler2D src;
                uniform vec3 keyColor;
                varying vec2 vUv;
                
                void main() {
                    vec4 tex = texture2D(src, vUv);
                    
                    // Hitung perbedaan warna antara warna piksel dan keyColor
                    float chroma_dist = distance(keyColor, tex.rgb);
                    
                    // Nilai toleransi (bisa disesuaikan, 0.4 adalah nilai yang umum)
                    float tolerance = 0.4;
                    
                    // Jika perbedaan kurang dari toleransi, jadikan transparan (discard)
                    if (chroma_dist < tolerance) {
                        discard;
                    }
                    
                    gl_FragColor = tex;
                }
            `
        });

        // 2. PLAY-ON-MARKER-FOUND COMPONENT: Memutar/menghentikan video saat marker ditemukan
        const videoElement = document.getElementById('videoAnimasi');

        AFRAME.registerComponent('play-on-marker-found', {
            init: function () {
                const marker = this.el.parentNode; 
                // Pastikan video elemen sudah dimuat sebelum mengakses komponen material
                const video = document.querySelector('#videoAnimasi');

                marker.addEventListener('markerFound', function () {
                    console.log('Marker Ditemukan. Memutar video...');
                    if (video) video.play();
                });

                marker.addEventListener('markerLost', function () {
                    console.log('Marker Hilang. Menghentikan video...');
                    if (video) {
                        video.pause();
                        video.currentTime = 0; 
                    }
                });

                video.addEventListener('loadedmetadata', () => {
                    video.muted = true; // Wajib untuk autoplay di HP
                    video.play().catch(error => {
                        console.warn("Autoplay gagal, mungkin karena kebijakan browser:", error);
                    });
                });
            }
        });
    </script>

</body>
</html>